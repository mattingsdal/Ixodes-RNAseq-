module load java
module load fastqc
module load sortmerna/2.1

fastqc *gz -t 10


for i in A_S65 B_S66 C_S67 D_S68 F_S69 G_S70 I_S72 K_S73 L_S74 M_S75 N_S76 P_S77 Q_S78 R_S79
do
gunzip $i*gz
/cluster/software/VERSIONS/sortmerna/2.0/scripts/merge-paired-reads.sh ${i}_R1_001.fastq ${i}_R2_001.fastq ${i}.fastq

sortmerna --ref \
/usit/abel/u1/mortema/sortmerna/silva-bac-16s-id90.fasta,/usit/abel/u1/mortema/sortmerna/silva-bac-16s-id90.idx:\
/usit/abel/u1/mortema/sortmerna/silva-bac-23s-id98.fasta,/usit/abel/u1/mortema/sortmerna/silva-bac-23s-id98.ids:\
/usit/abel/u1/mortema/sortmerna/silva-arc-16s-id95.fasta,/usit/abel/u1/mortema/sortmerna/silva-arc-16s-id95.idx:\
/usit/abel/u1/mortema/sortmerna/silva-arc-23s-id98.fasta,/usit/abel/u1/mortema/sortmerna/silva-arc-23s-id98.idx:\
/usit/abel/u1/mortema/sortmerna/silva-euk-18s-id95.fasta,/usit/abel/u1/mortema/sortmerna/silva-euk-18s-id95.idx:\
/usit/abel/u1/mortema/sortmerna/silva-euk-28s-id98.fasta,/usit/abel/u1/mortema/sortmerna/silva-euk-28s-id98.idx:\
/usit/abel/u1/mortema/sortmerna/rfam-5s-database-id98.fasta,/usit/abel/u1/mortema/sortmerna/rfam-5s-database-id98.idx:\
/usit/abel/u1/mortema/sortmerna/rfam-5.8s-database-id98.fasta,/usit/abel/u1/mortema/sortmerna/rfam-5.8s-database-id98.idx \
 --reads ${i}.fastq --fastx --aligned sortmerna/${i}.reads_rRNA --other sortmerna/${i}.reads_non_rRNA -a 32 -m 462144 --paired_in -v

## unmerge
/cluster/software/VERSIONS/sortmerna/2.0/scripts/unmerge-paired-reads.sh sortmerna/${i}.reads_rRNA ${i}_1_noRNA.fq ${i}_2_noRNA.fq

rm *fastq

done

#### use trimmomatric to loop through non-RNA reads to trim quaity and unpaired

module load java

for i in A_S65 B_S66 C_S67 D_S68 F_S69 G_S70 I_S72 K_S73 L_S74 M_S75 N_S76 P_S77 Q_S78 R_S79
do

java -Xmx1G -jar ~/software/Trimmomatic-0.36/trimmomatic-0.36.jar PE -phred33 -threads 16 \
${i}_1_noRNA.fq ${i}_2_noRNA.fq ${i}_left_P_qtrim.fq ${i}_left_U_qtrim.fq ${i}_right_P_qtrim.fq ${i}_right_U_qtrim.fq \
ILLUMINACLIP:/usit/abel/u1/mortema/software/Trimmomatic-0.36/adapters/TruSeq3-PE-2.fa:2:30:10 SLIDINGWINDOW:5:20 LEADING:5 TRAILING:5 MINLEN:50

done

### run Trinity

